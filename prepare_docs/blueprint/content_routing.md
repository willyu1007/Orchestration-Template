
# 知识路由

为了减少AI在检索文档的不确定性，提高获取知识的效率和密度。我们构建了多级文档路由系统，旨在提高任务规划的效率和可靠性，给予AI明确的指导至相关信息。知识路由的两个主要目标有两个：

- 将适当的知识告知代码大模型：给AI的知识既要准确，同时也要精简。
- 路径引导符合大模型的工作模式：要发挥AI的任务编排体系的灵活性。

为达成上述两个目标，文档路由采用三层结构：范围 → 主题 → 时机。对于每个组合，路由条目将指定目标文档，即AI应在该情况下加载的实际文档链接。这类似于图书馆的目录表索引：告诉AI应该查阅图书馆的哪个部分找哪些书以获取所需知识。

我们将路由条目和目标文档视为两类文档：`路由文档`和`知识文档`，前者通过三层结构帮助AI高效检索，后者则包含了上下文的具体内容。我们建立了一套基础设施，知识路由，用于规范和管理项目中的路由文档和知识文档。

## 基本规则
由于路由文档和知识文档承担的职责完全不同，下面我们来分开定义两类文档的规范。

### 路由文档
- 命名规范：路由文档的文档名称必须为`ROUTING.md`
- 内容规范：文档必须要包含路由，路由形式示例：
```yaml
context_routes:
  - scope: Execution – Quality Gates
    topics:
      - name: Pre-commit Checks
        when:
          - description: preparing to run make dev_check
            target_docs:
              - path: /doc_agent/quickstart/quality-quickstart.md
              - path: /scripts/README.md
```
- 分层指南：知识路由按照领域（scope）、主题（topic）、情形（when），将AI任务编排所需的上下文映射到分层体系中，以保障AI指导对于任何软定义的任务应该加载哪些上下文。  
  - scope：生命周期或工作场景，描述路由节点覆盖的"责任域"或"工作阶段"，与任务编排保持顶层一致性
  - topic：具体职责或能力单元，聚焦"要处理什么类型的问题/任务"。topic将广义责任域进一步拆分成可路由的能力单元
  - when：在什么情境下需要加载"这一组文档/资源"；一句话说明场景与目标，让智能体根据具体需求匹配合适的文档集合
  - path：目标文档的路径；同一套路由可以包含一个或多个目标文档，但不允许存在空路径

- 路由规范：完整的路由包含三个层级和至少一个目标路径，实际使用中我们并不要每个路由文档都使用完整的层级结构
  - 目标路径：可以为知识文档，也可以为其他路由文档
  - 层级结构：

- 前置元数据：按照规范，所有面向AI阅读的文档
  - purpose 应该与topic对齐（topic字面应该包含purpose的一个或多个关键词）？？？？？？？
  - 3
  - 4

### 知识文档

- 命名规范：无强制命名要求，仅需要满足模板统一的文档命名规范
- 前置元数据：
  - 1
  - 2
  - 3

- 内容规范：除了要易于AI阅读外，文档内容还需要满足渐进式原则，即如果内容可以被明确区分，选用下列两种做法精简所需加载的上下文：
  1. 将文档拆分成多个文档，分别提供前置元数据；该做法需要重新注册文档，以确保路由正常
  2. 将内容分为多个章节，并在文档开头提供明确的段落索引；


- 常见的知识文档类型
  - 1
  - 2
  - 3

### 其他文档

知识路由仅需要包含上述两种类型的文档，其他任何文档都不应该被包含在知识路由中。我们对典型的文档类型进行梳理。
- 能力路由文档：这类文档统一命名为`ABILITY.md`，用于帮助AI找到合适的工具；详见<ability_routing.md>文档
- 策略和规则文档：这类文档是面向`AGENTS.md`的，用于规范AI的运行策略；详见<instruction_ai.md>文档
- 上下文相关文档：这类文档用于记录AI的思考过程和工作成果，其维护职责和文档使用都归属于模块实例；详见<modulate.md>中的相关内容
- 格式规范文档：这类文档并不会直接提供任务编排所需知识，但可能会提供执行所需信息（例如写入操作）。理想情况下，规范格式的相关操作应被包装成能力，AI可以直接调用能力完成写入/获取正确格式。
- 面向人类的文档：除特殊情况外，这类文档的内容不应该被AI阅读

不论如何，所有的文档都需要按照规范填写前置元数据，按照策略规范，AI将会检查元数据内容，以保证路由链路的准确，并最终按照需求加载知识上下文。
---

## 路由维护


### 新增
项目开发过程中，以下情况都需要进行文档注册：
- 添加了新的知识文档
- 添加了新的路由文档
- 对已有的知识文档进行了拆分

**任何情况下**，不要手动完成知识文档的注册。模板将提供一个新增脚本，以确保知识路由的可用性。你可以通过以下方式调用注册脚手架：
- 直接运行知识路由的注册脚本
- 告诉AI你希望注册一个新的知识文档

### 删除
项目开发过程中，以下情况需要进行文档删除：
- 需要删除某个知识/路由文档
- 当某个知识文档的职责发生了变化（影响scope/topic/when），先删除再新增（需要重新定义路由条目）

**不要仅仅删除文件**，请调用模板提供的删除脚本，避免出现路由路径不可用的情况。你可以通过以下方式进行知识路由相关文档的删除：
- 直接运行知识文档删除脚本
- 告诉AI你希望删除一个知识/路由文档

### 触发机制


- CI集成：模板提供持续集成检验，定期检验文档是否包含了前置元数据、知识路由相关的文档是否符合规范、以及项目路由体系是否链路完整

### 模块化维护

### 三层结构规范
- scope：
- topic：
- when：
---



 - 跨文档交叉检验，每个文档都应该有front matter, purpose 应该与topic对齐（topic字面应该包含 doc purpose 的（某个或多个）关键词），如果leaf文档更新purpose， 则需要触发相应路由进行调整
  - 鼓励在 when 中引用命令或触发事件，而不仅是抽象描述，如 when: "Before running database migration scripts"。
  - 变更流程管控，路由/Agent 变更必须附带 checklist：更新文档、运行 lint、同步可视化表格、在 workdoc 中标记。
  - 在根级README中维护一个路由文档表，新增的面向AI的文档需要在README中注册登记，避免存在孤岛；同时在 `doc_agent/orchestration/doc-node-map.yaml` 中登记 `ROUTING.md` topic/when 与 `AGENTS.md`、`CAPABILITIES.md` 中 `graph_node_id`、`capability_tags` 的映射，方便 lint。
  - 统一抽象层级，维护一个文档（always read），用于定义标准 scope 范畴（比如生命周期、治理域、资产域），要求所有 `ROUTING.md` 明确继承或声明等价 scope，避免各自随意命名；相邻的 `AGENTS.md` 与 `CAPABILITIES.md` 仅引用这些 scope，不可自建新称谓。
  - 结构化约束 Topic/When，限定字段必填、值域、长度、关键词等，用关键词表（如 schema change、guardrail update、pre-commit）限制取词，减少同义词混乱。编写 when 时，要聚焦"识别条件 + 阅读目的"。
  - 提供检验脚本，加入语义检验（例如 when 是否包含触发词、Topic 是否与下游 doc 的 purpose 匹配等）。当叶子文档的purpose变更时，需要运行脚本并检查对应的when是否仍然准确。


  更新根 README 表时，同步检查子目录缩略表是否需要变更。
	- 子目录也可以按照上述规则维护局部缩略表（大部分不需要scope）。这些表格在更新路由时（维护SOP）需要同步更新，形成流程约束，更新方式需要在维护SOP文档（或下沉文档）中说明。
	- 可以维护一个编写指南（含标准命名、正反例、共享 topic 的处理方式），在新目录或模块接入时引用，保证结构演进的一致性。